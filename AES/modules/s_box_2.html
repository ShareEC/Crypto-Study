<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AES ì „ì²´ S-Box ë§¤íŠ¸ë¦­ìŠ¤ (256x256)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Noto+Sans+KR:wght@300;400;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        /* í”½ì…€ì„ ì„ ëª…í•˜ê²Œ ë³´ì—¬ì£¼ê¸° ìœ„í•œ ì„¤ì • */
        canvas {
            image-rendering: pixelated;
            width: 100%;
            max-width: 512px; /* í™”ë©´ì—ì„œëŠ” 2ë°°ë¡œ í™•ëŒ€í•´ì„œ ë³´ì—¬ì¤Œ */
            aspect-ratio: 1 / 1;
        }
    </style>
</head>
<body class="bg-slate-900 min-h-screen flex flex-col items-center py-8 px-4 text-slate-200">
	<div class="fixed top-4 left-4 z-50">
        <a href="../index.html" class="flex items-center gap-2 bg-slate-800/80 hover:bg-slate-700 text-slate-300 px-4 py-2 rounded-full border border-slate-600 transition shadow-lg backdrop-blur-sm text-sm font-bold no-underline">
            <span>ğŸ </span>
        </a>
    </div>
    <!-- Main Container -->
    <div class="bg-slate-800 shadow-2xl rounded-2xl p-6 w-full max-w-4xl border border-slate-700">
        
        <!-- Header -->
        <div class="mb-6 text-center">
            <h1 class="text-2xl font-bold text-white mb-2">AES GF(2â¸) ì „ì²´ ë§¤íŠ¸ë¦­ìŠ¤</h1>
            <p class="text-slate-400 text-sm">
                ê°€ë¡œ(<span class="text-blue-400 font-bold">b</span>) Ã— ì„¸ë¡œ(<span class="text-red-400 font-bold">a</span>) = 65,536ê°œì˜ ì „ì²´ ê³±ì…ˆ í‘œ<br>
                <span class="text-green-400 font-bold">â— ë…¹ìƒ‰ ì </span>ë“¤ì€ ê³±ì…ˆ ê²°ê³¼ê°€ <span class="font-bold text-white">1</span>ì´ ë˜ëŠ” ì—­ì› ê´€ê³„ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
            </p>
        </div>

        <!-- Controls -->
        <div class="flex flex-col md:flex-row gap-6 justify-center items-start mb-6">
            
            <!-- Left: Controls & Info -->
            <div class="w-full md:w-1/3 flex flex-col gap-4">
                <div class="bg-slate-700 p-4 rounded-xl border border-slate-600">
                    <label class="block text-xs font-bold text-slate-400 mb-2 uppercase">ì…ë ¥ê°’ (a / Row)</label>
                    <div class="flex gap-2">
                        <div class="relative w-full">
                            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 font-bold">0x</span>
                            <input type="text" id="inputHex" value="53" maxlength="2" 
                                class="mono pl-8 pr-3 py-2 w-full bg-slate-800 border border-slate-600 rounded focus:border-blue-500 focus:outline-none text-white font-bold text-lg uppercase"
                                onkeypress="return /[0-9a-fA-F]/.test(event.key)"
                            >
                        </div>
                        <button onclick="highlightInverse()" class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 px-4 rounded transition-colors whitespace-nowrap">
                            ì°¾ê¸°
                        </button>
                    </div>
                </div>

                <div id="infoBox" class="bg-slate-900 p-4 rounded-xl border border-slate-700 hidden">
                    <div class="text-center mb-3">
                        <span class="bg-green-900 text-green-300 text-xs px-2 py-1 rounded-full font-bold">ê²°ê³¼ í™•ì¸</span>
                    </div>
                    <div class="grid grid-cols-3 gap-2 text-center text-sm mb-2 font-bold text-slate-500">
                        <div>Row (a)</div>
                        <div>Col (b)</div>
                        <div>Result</div>
                    </div>
                    <div class="grid grid-cols-3 gap-2 text-center text-xl mono font-bold items-center">
                        <div class="text-red-400" id="dispA">--</div>
                        <div class="text-blue-400" id="dispB">--</div>
                        <div class="text-white" id="dispRes">--</div>
                    </div>
                    <div class="mt-3 text-xs text-slate-400 text-center leading-relaxed">
                        <span class="text-red-400">0x<span id="txtA">--</span></span>ë²ˆì§¸ ì¤„ì—ì„œ<br>
                        ì˜¤ë¥¸ìª½ìœ¼ë¡œ <span class="text-blue-400">0x<span id="txtB">--</span></span>ì¹¸ ì´ë™í•˜ë©´<br>
                        ê°’ì´ <span class="text-white font-bold">0x01</span>ì…ë‹ˆë‹¤.
                    </div>
                </div>
            </div>

            <!-- Right: The Matrix (Canvas) -->
            <div class="w-full md:w-2/3 flex justify-center relative group">
                <!-- Canvas Wrapper -->
                <div class="relative border-2 border-slate-600 rounded bg-black shadow-lg">
                    <canvas id="gfCanvas" width="256" height="256"></canvas>
                    
                    <!-- Crosshair overlays -->
                    <div id="hLine" class="absolute left-0 w-full h-[2px] bg-red-500 opacity-0 pointer-events-none transition-opacity"></div>
                    <div id="vLine" class="absolute top-0 h-full w-[2px] bg-blue-500 opacity-0 pointer-events-none transition-opacity"></div>
                    
                    <!-- Tooltip -->
                    <div id="tooltip" class="absolute pointer-events-none hidden bg-slate-800 text-white text-xs p-2 rounded border border-slate-500 shadow-xl z-50 whitespace-nowrap mono"></div>
                </div>
                
                <!-- Axis Labels -->
                <div class="absolute -left-6 top-0 text-xs text-slate-500 h-full flex flex-col justify-between py-1 mono">
                    <span>00</span><span>80</span><span>FF</span>
                </div>
                <div class="absolute top-full left-0 w-full flex justify-between px-1 text-xs text-slate-500 mt-1 mono">
                    <span>00</span><span>80</span><span>FF</span>
                </div>
                <!-- Axis Names -->
                <div class="absolute -left-10 top-1/2 -rotate-90 text-xs font-bold text-red-500">Row (a)</div>
                <div class="absolute -bottom-6 left-1/2 text-xs font-bold text-blue-500">Col (b)</div>
            </div>
        </div>

    </div>

    <script>
        const canvas = document.getElementById('gfCanvas');
        const ctx = canvas.getContext('2d');
        const width = 256;
        const height = 256;

        // Image Data Buffer
        const imgData = ctx.createImageData(width, height);
        const data = imgData.data;

        // --- GF(2^8) Logic ---
        function gmult(a, b) {
            let p = 0;
            for (let i = 0; i < 8; i++) {
                if ((b & 1) !== 0) p ^= a;
                let hi_bit = (a & 0x80);
                a <<= 1;
                if (hi_bit !== 0) a ^= 0x11B;
                a &= 0xFF;
                b >>= 1;
            }
            return p;
        }

        function toHex(n) {
            return n.toString(16).toUpperCase().padStart(2, '0');
        }

        // --- Render the full matrix ---
        // This runs once.
        function renderMatrix() {
            for (let y = 0; y < 256; y++) { // Row (a)
                for (let x = 0; x < 256; x++) { // Col (b)
                    const val = gmult(y, x);
                    const idx = (y * 256 + x) * 4;

                    if (val === 1) {
                        // Inverse found! Highlight Green
                        data[idx] = 0;     // R
                        data[idx + 1] = 255; // G
                        data[idx + 2] = 100;   // B
                        data[idx + 3] = 255; // Alpha
                    } else if (val === 0) {
                        // Zero is black
                        data[idx] = 0;
                        data[idx + 1] = 0;
                        data[idx + 2] = 0;
                        data[idx + 3] = 255;
                    } else {
                        // Other values: Very dark gray just to show existence
                        // Or make it a heatmap based on value? Let's keep it subtle dark blue
                        const intensity = 20 + (val / 255) * 40; 
                        data[idx] = intensity;
                        data[idx + 1] = intensity;
                        data[idx + 2] = intensity + 20; 
                        data[idx + 3] = 255;
                    }
                }
            }
            ctx.putImageData(imgData, 0, 0);
        }

        // --- Highlight Logic ---
        function highlightInverse() {
            const inputEl = document.getElementById('inputHex');
            const rowVal = parseInt(inputEl.value, 16);

            if (isNaN(rowVal) || rowVal < 0 || rowVal > 255) {
                alert("ìœ íš¨í•œ 16ì§„ìˆ˜(00~FF)ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
                return;
            }

            // Find inverse (col where val == 1)
            let colVal = -1;
            for(let c=0; c<256; c++) {
                if(gmult(rowVal, c) === 1) {
                    colVal = c;
                    break;
                }
            }

            // Update UI
            const hLine = document.getElementById('hLine');
            const vLine = document.getElementById('vLine');
            const infoBox = document.getElementById('infoBox');

            // Canvas display size (CSS pixels) vs Actual pixels
            // Canvas is 256x256 logic, but displayed at max-width: 512px
            // We use percentages for positioning overlays
            const yPercent = (rowVal / 255) * 100;
            
            // Set Horizontal Line (Row a)
            hLine.style.top = yPercent + "%";
            hLine.style.opacity = 1;

            if (colVal !== -1) {
                const xPercent = (colVal / 255) * 100;
                
                // Set Vertical Line (Col b)
                vLine.style.left = xPercent + "%";
                vLine.style.opacity = 1;

                // Update Info Panel
                infoBox.classList.remove('hidden');
                document.getElementById('dispA').innerText = toHex(rowVal);
                document.getElementById('dispB').innerText = toHex(colVal);
                document.getElementById('dispRes').innerText = "01";
                document.getElementById('txtA').innerText = toHex(rowVal);
                document.getElementById('txtB').innerText = toHex(colVal);
            } else {
                // Should only happen for 0x00
                vLine.style.opacity = 0;
                infoBox.classList.remove('hidden');
                document.getElementById('dispA').innerText = toHex(rowVal);
                document.getElementById('dispB').innerText = "NONE";
                document.getElementById('dispRes').innerText = "00";
                document.getElementById('txtA').innerText = toHex(rowVal);
                document.getElementById('txtB').innerText = "--";
            }
        }

        // --- Mouse Interaction ---
        function handleMouseMove(e) {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;

            const x = Math.floor((e.clientX - rect.left) * scaleX);
            const y = Math.floor((e.clientY - rect.top) * scaleY);

            if (x >= 0 && x < 256 && y >= 0 && y < 256) {
                const val = gmult(y, x);
                const tooltip = document.getElementById('tooltip');
                
                tooltip.style.display = 'block';
                tooltip.style.left = (e.clientX - rect.left + 15) + 'px';
                tooltip.style.top = (e.clientY - rect.top + 15) + 'px';
                
                tooltip.innerHTML = `
                    <span class="text-red-300">Row(a): ${toHex(y)}</span><br>
                    <span class="text-blue-300">Col(b): ${toHex(x)}</span><br>
                    <span class="text-white font-bold border-t border-slate-500 mt-1 pt-1 block">Val : ${toHex(val)}</span>
                `;
            }
        }

        canvas.addEventListener('mousemove', handleMouseMove);
        canvas.addEventListener('mouseleave', () => {
            document.getElementById('tooltip').style.display = 'none';
        });
        canvas.addEventListener('click', (e) => {
            // Click to set input
            const rect = canvas.getBoundingClientRect();
            const scaleY = canvas.height / rect.height;
            const y = Math.floor((e.clientY - rect.top) * scaleY);
            
            document.getElementById('inputHex').value = toHex(y);
            highlightInverse();
        });

        // Enter key
        document.getElementById('inputHex').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                highlightInverse();
            }
        });

        // Initialize
        renderMatrix();
        highlightInverse(); // Show default 53

    </script>
</body>
</html>