<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AES ëª¨ë“œë³„ êµ¬ì¡°ë„ (Block View)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../../assets/css/style.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&display=swap');
        
        .mono { font-family: 'Fira Code', monospace; }

        /* --- 1. AES Engine Box --- */
        .aes-box {
            border: 2px solid #22c55e;
            background-color: #f0fdf4;
            border-radius: 8px;
            padding: 10px;
            width: 130px;
            color: #1e293b;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: relative;
            z-index: 20;
        }
        .aes-title { font-weight: bold; font-size: 0.85rem; color: #15803d; margin-bottom: 5px; }
        .aes-step {
            border: 1px solid #86efac; background: white;
            width: 100%; text-align: center;
            font-size: 0.65rem; padding: 2px 0; margin: 1px 0;
            color: #15803d; font-family: monospace;
        }
        .aes-loop {
            border: 1px dashed #22c55e; padding: 3px; width: 100%;
            margin: 3px 0; border-radius: 4px; background: rgba(34, 197, 94, 0.05);
        }

        /* --- 2. Data Blocks --- */
        .data-block {
            width: 90px; padding: 8px 4px; text-align: center;
            border-radius: 6px; font-weight: bold; font-size: 0.75rem;
            position: relative; z-index: 20;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .block-plain { background: #334155; color: white; border: 1px solid #475569; }
        .block-cipher { background: #0f172a; color: #67e8f9; border: 1px solid #06b6d4; }
        .block-iv { background: #581c87; color: #e9d5ff; border: 1px solid #a855f7; width: 50px; font-size: 0.7rem; }
        .block-ctr { background: #be185d; color: #ffe4e6; border: 1px solid #f43f5e; }
        
        .xor-circle {
            width: 28px; height: 28px; border-radius: 50%;
            background: #1e293b; border: 2px solid #94a3b8;
            color: white; display: flex; align-items: center; justify-content: center;
            font-size: 1.1rem; z-index: 20;
        }

        /* --- 3. Layout & Lines --- */
        .mode-container {
            display: flex; 
            gap: 60px; 
            justify-content: center; 
            /* [ìˆ˜ì •] ìŠ¤í¬ë¡¤ ì‹œ ì˜ë¦¬ì§€ ì•Šê²Œ íŒ¨ë”© ë„‰ë„‰íˆ */
            padding: 40px 60px; 
            position: relative; 
            min-height: 500px;
            /* ì¤‘ìš”: ë‚´ìš©ë¬¼ë§Œí¼ ë„ˆë¹„ í™•ë³´ (ì°Œê·¸ëŸ¬ì§ ë°©ì§€) */
            min-width: max-content; 
        }
        @media (min-width: 768px) {
            .mode-container { gap: 100px; }
        }

        .block-column {
            display: flex; flex-direction: column; align-items: center; gap: 30px;
            position: relative;
        }
        
        /* SVG Layer */
        #svg-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 10;
        }
        .arrow-line { stroke: #64748b; stroke-width: 2; fill: none; marker-end: url(#arrow); }
        .arrow-feedback { stroke: #ef4444; stroke-width: 2; fill: none; stroke-dasharray: 6; marker-end: url(#arrow-red); animation: dash 1s linear infinite; }

        @keyframes dash { to { stroke-dashoffset: -12; } }

        /* Tabs */
        .nav-btn { 
            padding: 8px 12px; color: #94a3b8; border-bottom: 2px solid transparent; 
            transition: all 0.2s; font-size: 0.9rem;
        }
        .nav-btn.active { color: #fff; border-bottom-color: #22c55e; font-weight: bold; }

    </style>
</head>
<body class="flex flex-col items-center min-h-screen bg-slate-900 pb-10">
    
    <a href="../index.html" class="home-btn"><span>ğŸ </span> Back</a>

    <div class="w-full bg-slate-900 border-b border-slate-700 p-4 flex justify-center pt-14 md:pt-6">
        <div class="max-w-5xl w-full flex flex-col md:flex-row justify-between items-center gap-4">
            <h1 class="text-lg md:text-xl font-bold text-white text-center">AES ëª¨ë“œë³„ êµ¬ì¡°ë„</h1>
            <div class="flex gap-1 md:gap-2 bg-slate-800 p-1 rounded-lg">
                <button onclick="setMode('ECB')" id="btn-ECB" class="nav-btn active">ECB</button>
                <button onclick="setMode('CBC')" id="btn-CBC" class="nav-btn">CBC</button>
                <button onclick="setMode('CTR')" id="btn-CTR" class="nav-btn">CTR</button>
            </div>
        </div>
    </div>

    <div class="max-w-3xl w-full text-center mt-6 mb-2 px-4">
        <p id="desc-text" class="text-slate-400 text-sm bg-slate-800 p-4 rounded-lg border border-slate-700 leading-relaxed">
        </p>
    </div>

    <div class="max-w-6xl w-full px-2 md:px-0">
        
        <div class="bg-slate-800/50 rounded-xl border border-slate-700 mt-4 relative overflow-x-auto custom-scrollbar">
            
            <div class="relative min-w-max" id="diagram-area">
                <svg id="svg-layer">
                    <defs>
                        <marker id="arrow" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto"><path d="M0,0 L0,6 L6,3 z" fill="#64748b"/></marker>
                        <marker id="arrow-red" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto"><path d="M0,0 L0,6 L6,3 z" fill="#ef4444"/></marker>
                    </defs>
                </svg>

                <div id="content-container" class="mode-container">
                    </div>
            </div>

        </div>
        <p class="text-center text-slate-500 text-xs mt-3 md:hidden">ğŸ‘† í‘œë¥¼ ì¢Œìš°ë¡œ ë°€ì–´ì„œ ì „ì²´ êµ¬ì¡°ë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
    </div>

    <script>
        const AES_ENGINE_HTML = `
            <div class="aes-box">
                <div class="aes-title">AES Encrypt</div>
                <div class="aes-step">add_round_key</div>
                <div class="aes-loop">
                    <div class="aes-step">sub_bytes</div>
                    <div class="aes-step">shift_rows</div>
                    <div class="aes-step">mix_columns</div>
                    <div class="aes-step">add_round_key</div>
                </div>
                <div class="aes-step">Final Round</div>
            </div>
        `;

        const MODES = {
            ECB: {
                desc: "<strong>ECB (Electronic Codebook):</strong> <span class='text-yellow-400'>í‰ë¬¸</span>ì´ <span class='text-green-400'>AES ë°•ìŠ¤</span>ë¡œ ë°”ë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤. ë¸”ë¡ ê°„ ì—°ê²°ì´ ì—†ì–´ íŒ¨í„´ì´ ë…¸ì¶œë©ë‹ˆë‹¤.",
                html: `
                    <div class="block-column">
                        <div class="data-block block-plain" id="ecb-p1">Plain 1</div>
                        <div id="ecb-aes1">${AES_ENGINE_HTML}</div>
                        <div class="data-block block-cipher" id="ecb-c1">Cipher 1</div>
                    </div>
                    <div class="block-column">
                        <div class="data-block block-plain" id="ecb-p2">Plain 2</div>
                        <div id="ecb-aes2">${AES_ENGINE_HTML}</div>
                        <div class="data-block block-cipher" id="ecb-c2">Cipher 2</div>
                    </div>
                `,
                connections: [
                    { from: 'ecb-p1', to: 'ecb-aes1' }, { from: 'ecb-aes1', to: 'ecb-c1' },
                    { from: 'ecb-p2', to: 'ecb-aes2' }, { from: 'ecb-aes2', to: 'ecb-c2' }
                ]
            },
            CBC: {
                desc: "<strong>CBC (Cipher Block Chaining):</strong> <span class='text-yellow-400'>í‰ë¬¸</span>ì´ AES ë°•ìŠ¤ì— ë“¤ì–´ê°€ê¸° ì „ <span class='text-blue-400 font-bold'>XOR</span>ì„ ê±°ì¹©ë‹ˆë‹¤. <span class='text-red-400'>ë¹¨ê°„ ì ì„ </span>ì„ í†µí•´ ì• ë¸”ë¡ì˜ ê²°ê³¼ê°€ ë’¤ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.",
                html: `
                    <div class="block-column">
                        <div class="flex items-center gap-1 md:gap-2">
                            <div class="data-block block-iv" id="cbc-iv">IV</div>
                            <div class="text-slate-500 text-xs">â†’</div>
                            <div class="xor-circle" id="cbc-xor1">âŠ•</div>
                            <div class="text-slate-500 text-xs">â†</div>
                            <div class="data-block block-plain" id="cbc-p1">Plain 1</div>
                        </div>
                        <div id="cbc-aes1">${AES_ENGINE_HTML}</div>
                        <div class="data-block block-cipher" id="cbc-c1">Cipher 1</div>
                    </div>

                    <div class="block-column">
                        <div class="flex items-center gap-1 md:gap-2">
                            <div class="w-[50px]"></div> 
                            <div class="text-slate-500 w-2 md:w-4"></div>
                            <div class="xor-circle" id="cbc-xor2">âŠ•</div>
                            <div class="text-slate-500 text-xs">â†</div>
                            <div class="data-block block-plain" id="cbc-p2">Plain 2</div>
                        </div>
                        <div id="cbc-aes2">${AES_ENGINE_HTML}</div>
                        <div class="data-block block-cipher" id="cbc-c2">Cipher 2</div>
                    </div>
                `,
                connections: [
                    { from: 'cbc-xor1', to: 'cbc-aes1' }, { from: 'cbc-aes1', to: 'cbc-c1' },
                    { from: 'cbc-xor2', to: 'cbc-aes2' }, { from: 'cbc-aes2', to: 'cbc-c2' },
                    { from: 'cbc-c1', to: 'cbc-xor2', type: 'feedback' }
                ]
            },
            CTR: {
                desc: "<strong>CTR (Counter Mode):</strong> <span class='text-yellow-400'>í‰ë¬¸</span>ì€ AES ë°•ìŠ¤ì— <strong>ë“¤ì–´ê°€ì§€ ì•ŠìŠµë‹ˆë‹¤.</strong> <span class='text-pink-500'>ì¹´ìš´í„°(ìˆ«ì)</span>ê°€ AES ë°•ìŠ¤ì— ë“¤ì–´ê°€ ë‚œìˆ˜ë¥¼ ë§Œë“¤ê³ , ë°–ì—ì„œ í‰ë¬¸ê³¼ í•©ì³ì§‘ë‹ˆë‹¤.",
                html: `
                    <div class="block-column">
                        <div class="data-block block-ctr" id="ctr-cnt1">Counter 1</div>
                        <div id="ctr-aes1">${AES_ENGINE_HTML}</div>
                        <div class="flex items-center gap-1 md:gap-2 mt-4">
                            <div class="text-[10px] text-blue-400 font-bold w-12 text-right">KeyStream</div>
                            <div class="xor-circle" id="ctr-xor1">âŠ•</div>
                            <div class="text-slate-500 text-xs">â†</div>
                            <div class="data-block block-plain" id="ctr-p1">Plain 1</div>
                        </div>
                        <div class="data-block block-cipher" id="ctr-c1">Cipher 1</div>
                    </div>

                    <div class="block-column">
                        <div class="data-block block-ctr" id="ctr-cnt2">Counter 2</div>
                        <div id="ctr-aes2">${AES_ENGINE_HTML}</div>
                        <div class="flex items-center gap-1 md:gap-2 mt-4">
                            <div class="text-[10px] text-blue-400 font-bold w-12 text-right">KeyStream</div>
                            <div class="xor-circle" id="ctr-xor2">âŠ•</div>
                            <div class="text-slate-500 text-xs">â†</div>
                            <div class="data-block block-plain" id="ctr-p2">Plain 2</div>
                        </div>
                        <div class="data-block block-cipher" id="ctr-c2">Cipher 2</div>
                    </div>
                `,
                connections: [
                    { from: 'ctr-cnt1', to: 'ctr-aes1' }, { from: 'ctr-aes1', to: 'ctr-xor1' }, { from: 'ctr-xor1', to: 'ctr-c1' },
                    { from: 'ctr-cnt2', to: 'ctr-aes2' }, { from: 'ctr-aes2', to: 'ctr-xor2' }, { from: 'ctr-xor2', to: 'ctr-c2' }
                ]
            }
        };

        let currentMode = 'ECB';

        function setMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn-${mode}`).classList.add('active');
            document.getElementById('desc-text').innerHTML = MODES[mode].desc;
            document.getElementById('content-container').innerHTML = MODES[mode].html;
            setTimeout(drawLines, 50);
            setTimeout(drawLines, 500); 
        }

        function drawLines() {
            const svg = document.getElementById('svg-layer');
            const defs = svg.querySelector('defs').outerHTML;
            svg.innerHTML = defs; 

            const conns = MODES[currentMode].connections;
            if (!conns) return;

            // [ì¤‘ìš”] ìŠ¤í¬ë¡¤ë˜ëŠ” ì»¨í…ì¸  ë‚´ë¶€(diagram-area)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì¢Œí‘œ ê³„ì‚°
            const containerRect = document.getElementById('diagram-area').getBoundingClientRect();

            conns.forEach(c => {
                const el1 = document.getElementById(c.from);
                const el2 = document.getElementById(c.to);
                
                if (el1 && el2) {
                    const r1 = el1.getBoundingClientRect();
                    const r2 = el2.getBoundingClientRect();

                    const x1 = r1.left + r1.width / 2 - containerRect.left;
                    const y1 = r1.bottom - containerRect.top; 
                    
                    let x2 = r2.left + r2.width / 2 - containerRect.left;
                    let y2 = r2.top - containerRect.top;

                    let d = '';
                    let cls = 'arrow-line';
                    let marker = 'url(#arrow)';

                    if (c.type === 'feedback') {
                        const startX = x1;
                        const startY = y1;
                        const targetX = r2.left - containerRect.left; 
                        const targetY = r2.top + r2.height/2 - containerRect.top;
                        const midX = (x1 + x2) / 2 - 30; 

                        d = `M ${startX} ${startY} 
                             L ${startX} ${startY + 25} 
                             L ${midX} ${startY + 25} 
                             L ${midX} ${targetY} 
                             L ${targetX} ${targetY}`;
                             
                        cls = 'arrow-feedback';
                        marker = 'url(#arrow-red)';
                    } else {
                        d = `M ${x1} ${y1} L ${x2} ${y2}`;
                    }

                    const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    path.setAttribute("d", d);
                    path.setAttribute("class", cls);
                    if(marker) path.setAttribute("marker-end", marker);
                    svg.appendChild(path);
                }
            });
        }

        window.onload = () => setMode('ECB');
        window.onresize = drawLines;

    </script>
</body>
</html>
